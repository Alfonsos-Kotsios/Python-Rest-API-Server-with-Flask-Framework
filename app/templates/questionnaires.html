<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>UniQ | Ερωτηματολόγια</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/questionnaires.css') }}">
  <link rel="stylesheet" href="../static/css/home.css">
</head>
<body class="body">

  <nav class="navbar">
     <a class="nav-link" href="{{ url_for('home') }}">🏠 Αρχική</a>
     <a class="nav-link" href="{{ url_for('get_questionnaires') }}">📄 Προβολή Ερωτηματολογίων</a>
    {% if session.username %}
      <span class="nav-user">👤 {{ session.username }}</span>
      <a class="nav-link" href="{{ url_for('logout') }}">🚪 Έξοδος</a>
      <a class="nav-link" href="{{ url_for('change_password') }}">🔑Αλλαγή Κωδικού</a>
      <a class="nav-link" href="{{ url_for('create_questionnaire') }}">🛠️ Κατασκευη Ερωτηματολογίου</a>
      <a class="nav-link" href="{{ url_for('my_questionnaires') }}" >🔍 Προβολή Ερωτηματολογίων Φοιτητή</a>
    {% else %}
      <a class="nav-link" href="{{ url_for('login') }}">🔐 Είσοδος</a>
    {% endif %}
    {% if  session.username and session.role == 'admin'%}
      <a class="nav-link" href="{{ url_for('create_student') }}">➕ Δημιουργία Νέου Φοιτητή</a>
      <a class="nav-link" href="{{ url_for('delete_student') }}">🗑️ Διαγραφή Φοιτητή</a>
    {% endif %}
  </nav>

  <div class="container">
    <h1 class="heading">Διαθέσιμα Ερωτηματολόγια</h1>

    <!-- Επιλογές ταξινόμησης με βάση το πλήθος απαντήσεων -->
    <div class="sort-section">
      <p>Ταξινόμηση με βάση το πλήθος απαντήσεων:</p>
      <a class="sort-link" href="{{ url_for('get_questionnaires', sort='answer_count') }}">⬇️ Φθίνουσα</a>
      <a class="sort-link" href="{{ url_for('get_questionnaires', sort='answer_count_desc') }}"> ⬆️ Αύξουσα</a>
    </div>

    <!-- Φόρμα αναζήτησης ερωτηματολογίων με φίλτρα -->
    <form class="search-form" method="get" action="{{ url_for('search_questionnaires') }}">
      <input type="text" name="title" placeholder="Τίτλος" value="{{ request.args.get('title', '') }}">
      <input type="number" name="min_answers" placeholder="Ελάχιστες Απαντήσεις" value="{{ request.args.get('min_answers', '') }}">
      <input type="number" name="max_answers" placeholder="Μέγιστες Απαντήσεις" value="{{ request.args.get('max_answers', '') }}">
      <input type="text" name="student_name" placeholder="Όνομα Φοιτητή" value="{{ request.args.get('student_name', '') }}">
      <input type="text" name="department" placeholder="Τμήμα" value="{{ request.args.get('department', '') }}">
      <button type="submit">🔍 Αναζήτηση</button>
    </form>

    <!-- Λίστα με όλα τα διαθέσιμα ερωτηματολόγια -->
    <div class="questionnaire-list">
      {% for q in questionnaires %}
        <div class="questionnaire-card">
          <h2 class="questionnaire-title">{{ q.title }}</h2>
          <p>{{ q.description }}</p>
          {%if q.student_id == 0 %}
            <p><strong>Δημιουργηθηκε απο:</strong> ADMIN </p>
          {% else %}
            {% for s in students if s.reg_number == q.student_id %}
              <p><strong>Ονομα:</strong> {{ s.name }}</p>
              <p><strong>Επώνυμο:</strong> {{ s.surname }}</p>
              <p><strong>Τμήμα:</strong> {{ s.department }}</p>
            {% endfor %}
          {% endif %}
          <p><strong>Απαντήσεις:</strong> {{ q.answer_count }}</p>
          <a class="view-button" href="{{ url_for('view_questionnaire', questionnaire_id=q.questionnaire_id) }}">Προβολή ➡</a>
          {% if session.role == 'admin' %}
            <!-- Επιλογή διαγραφής ερωτηματολογίου για admin -->
            <form action="{{url_for('delete_questionnaire', questionnaire_id=q.questionnaire_id)}}" method="post">
                    <button class="view-button" type="submit" onclick="return confirm('Σίγουρα θες να διαγράψεις;')">🗑️ Διαγραφή</button>
                </form> 
          {% endif %}
        </div>
      {% else %}
        <!-- Μήνυμα αν δεν υπάρχουν διαθέσιμα ερωτηματολόγια -->
        <p>Δεν βρέθηκαν ερωτηματολόγια.</p>
      {% endfor %}
    </div>
  </div>
</body>
</html>



