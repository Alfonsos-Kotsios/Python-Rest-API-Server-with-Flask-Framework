<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>UniQ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/search_results.css') }}">
  <link rel="stylesheet" href="../static/css/home.css">
</head>
<body class="body">

  <nav class="navbar">
     <a class="nav-link" href="{{ url_for('home') }}">🏠 Αρχική</a>
     <a class="nav-link" href="{{ url_for('get_questionnaires') }}">📄 Προβολή Ερωτηματολογίων</a>
    {% if session.username %}
      <span class="nav-user">👤 {{ session.username }}</span>
      <a class="nav-link" href="{{ url_for('logout') }}">🚪 Έξοδος</a>
      <a class="nav-link" href="{{ url_for('change_password') }}">🔑Αλλαγή Κωδικού</a>
      <a class="nav-link" href="{{ url_for('create_questionnaire') }}">🛠️ Κατασκευη Ερωτηματολογίου</a>
      <a class="nav-link" href="{{ url_for('my_questionnaires') }}" >🔍 Προβολή Ερωτηματολογίων Φοιτητή</a>
    {% else %}
      <a class="nav-link" href="{{ url_for('login') }}">🔐 Είσοδος</a>
    {% endif %}
    {% if  session.username and session.role == 'admin'%}
      <a class="nav-link" href="{{ url_for('create_student') }}">➕ Δημιουργία Νέου Φοιτητή</a>
      <a class="nav-link" href="{{ url_for('delete_student') }}">🗑️ Διαγραφή Φοιτητή</a>
    {% endif %}
  </nav>

  <div class="container">
    <h1 class="heading">Αποτελέσματα Αναζήτησης Ερωτηματολογίων</h1>

    {% if questionnaires|length > 0 %}
      <p>Βρέθηκαν {{ questionnaires|length }} αποτελέσματα.</p>

      <div class="sort-section">
        <span>Ταξινόμηση με βάση πλήθος απαντήσεων:</span>
        <a class="sort-link" href="{{ url_for('search_questionnaires',
                    title=request.args.get('title'),
                    min_answers=request.args.get('min_answers'),
                    max_answers=request.args.get('max_answers'),
                    student_name=request.args.get('student_name'),
                    department=request.args.get('department'),
                    sort='answer_count') }}">⬇️ Φθίνουσα</a>
        <a class="sort-link" href="{{ url_for('search_questionnaires',
                    title=request.args.get('title'),
                    min_answers=request.args.get('min_answers'),
                    max_answers=request.args.get('max_answers'),
                    student_name=request.args.get('student_name'),
                    department=request.args.get('department'),
                    sort='answer_count_desc') }}">⬆️ Αύξουσα</a>
      </div>
    {% else %}
      <p class="no-results">Δεν βρέθηκαν αποτελέσματα για τα φίλτρα που δώσατε.</p>
    {% endif %}

    <div class="back-link">
      <a href="{{ url_for('get_questionnaires') }}">🔙 Επιστροφή στα Ερωτηματολόγια</a>
    </div>

    <div class="questionnaire-list">
      {% for q in questionnaires %}
        <div class="questionnaire-card">
          <h2 class="questionnaire-title">{{ q.title }}</h2>
          <p>{{ q.description }}</p>
          {%if q.student_id == 0 %}
            <p><strong>Δημιουργηθηκε απο:</strong> ADMIN </p>
          {% else %}
            {% for s in students if s.reg_number == q.student_id %}
              <p><strong>Ονομα:</strong> {{ s.name }}</p>
              <p><strong>Επώνυμο:</strong> {{ s.surname }}</p>
              <p><strong>Τμήμα:</strong> {{ s.department }}</p>
            {% endfor %}
          {% endif %}
          <p><strong>Απαντήσεις:</strong> {{ q.answer_count }}</p>
          <a class="view-button" href="{{ url_for('view_questionnaire', questionnaire_id=q.questionnaire_id) }}">Προβολή ➡</a>
          {% if session.role == 'admin' %}
            <a class="view-button" href="{{url_for('delete_questionnaire', questionnaire_id=q.questionnaire_id)}}">Διαγραφη</a>
          {% endif %}
        </div>
      {% endfor %}
    </div>

   
  </div>

</body>
</html>
